name: Skye Community AI Greeting

on:
  workflow_dispatch:
    inputs:
      trigger_source:
        description: 'Source (openwrt/manual/test)'
        required: false
        default: 'manual'
        type: string
      greeting_type:
        description: 'Greeting type'
        required: false
        default: 'auto'
        type: choice
        options: [auto, morning, afternoon, evening, night]
      force_weather:
        description: 'Force weather check'
        required: false
        default: false
        type: boolean
      test_mode:
        description: 'Test mode'
        required: false
        default: false
        type: boolean

jobs:
  send-greeting:
    runs-on: ubuntu-latest
    timeout-minutes: 6
    
    steps:
      - name: Setup Context
        id: context
        run: |
          export TZ='Asia/Jakarta'
          
          OPENWRT_MODE=false
          if command -v opkg >/dev/null 2>&1 || [[ -f /etc/openwrt_release ]] || [[ "${{ github.event.inputs.trigger_source }}" == "openwrt" ]]; then
            OPENWRT_MODE=true
            echo "üè† OpenWrt detected - optimized timing mode"
          fi
          
          CURRENT_DAY=$(date +%A)
          CURRENT_DATE=$(date +"%B %d, %Y")
          CURRENT_TIME=$(date +"%H:%M")
          HOUR=$(date +%H | sed 's/^0*//')
          DAY_NUM=$(date +%u)
          
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            MANUAL_TYPE="${{ github.event.inputs.greeting_type }}"
            if [[ "$MANUAL_TYPE" == "auto" ]]; then
              if [[ $HOUR -ge 5 && $HOUR -lt 12 ]]; then
                TYPE="morning"
              elif [[ $HOUR -ge 12 && $HOUR -lt 17 ]]; then
                TYPE="afternoon" 
              elif [[ $HOUR -ge 17 && $HOUR -lt 21 ]]; then
                TYPE="evening"
              else
                TYPE="night"
              fi
            else
              TYPE="$MANUAL_TYPE"
            fi
          else
            if [[ $HOUR -ge 5 && $HOUR -lt 12 ]]; then
              TYPE="morning"
            elif [[ $HOUR -ge 12 && $HOUR -lt 17 ]]; then
              TYPE="afternoon" 
            elif [[ $HOUR -ge 17 && $HOUR -lt 21 ]]; then
              TYPE="evening"
            else
              TYPE="night"
            fi
          fi
          
          if [[ $DAY_NUM -eq 6 || $DAY_NUM -eq 7 ]]; then
            CONTEXT="weekend"
          else
            CONTEXT="weekday"
          fi
          
          SPECIAL_CONTEXT=""
          case "$CURRENT_DAY" in
            "Monday") SPECIAL_CONTEXT="monday_motivation" ;;
            "Wednesday") SPECIAL_CONTEXT="hump_day" ;;
            "Friday") SPECIAL_CONTEXT="weekend_countdown" ;;
            "Sunday") SPECIAL_CONTEXT="sunday_prep" ;;
          esac
          
          echo "TYPE=$TYPE" >> $GITHUB_OUTPUT
          echo "CONTEXT=$CONTEXT" >> $GITHUB_OUTPUT
          echo "CURRENT_DAY=$CURRENT_DAY" >> $GITHUB_OUTPUT
          echo "CURRENT_DATE=$CURRENT_DATE" >> $GITHUB_OUTPUT
          echo "CURRENT_TIME=$CURRENT_TIME" >> $GITHUB_OUTPUT
          echo "SPECIAL_CONTEXT=$SPECIAL_CONTEXT" >> $GITHUB_OUTPUT
          echo "DAY_NUM=$DAY_NUM" >> $GITHUB_OUTPUT
          echo "OPENWRT_MODE=$OPENWRT_MODE" >> $GITHUB_OUTPUT
          
          echo "üéØ Context: $TYPE on $CURRENT_DAY ($SPECIAL_CONTEXT)"

      - name: Get Weather (BMKG Yogyakarta)
        id: weather
        run: |
          WEATHER_INFO=""
          echo "üå§Ô∏è Fetching BMKG weather for Yogyakarta..."
          
          BMKG_RAW=$(curl -s "https://api.bmkg.go.id/publik/prakiraan-cuaca?adm4=34.04.07.2001" --connect-timeout 8 --max-time 15 || echo "")
            
          if [[ -n "$BMKG_RAW" && "$BMKG_RAW" != *"error"* && "$BMKG_RAW" != *"Error"* ]]; then
            echo "‚úÖ BMKG API response received"
            
            TEMP=$(echo "$BMKG_RAW" | grep -o '"t":"[^"]*"' | head -1 | cut -d'"' -f4 || echo "")
            DESC=$(echo "$BMKG_RAW" | grep -o '"weather_desc":"[^"]*"' | head -1 | cut -d'"' -f4 || echo "")
            
            if [[ -n "$TEMP" || -n "$DESC" ]]; then
              echo "üå°Ô∏è Raw: $TEMP¬∞C | $DESC"
              
              WEATHER_CASUAL=""
              if [[ -n "$DESC" ]]; then
                DESC_LOWER=$(echo "$DESC" | tr '[:upper:]' '[:lower:]')
                
                if [[ "$DESC_LOWER" == *"hujan"* || "$DESC_LOWER" == *"rain"* ]]; then
                  WEATHER_CASUAL="hujan"
                elif [[ "$DESC_LOWER" == *"gerimis"* || "$DESC_LOWER" == *"drizzle"* ]]; then
                  WEATHER_CASUAL="gerimis"
                elif [[ "$DESC_LOWER" == *"panas"* || "$DESC_LOWER" == *"hot"* || "$DESC_LOWER" == *"terik"* ]]; then
                  WEATHER_CASUAL="panas"
                elif [[ "$DESC_LOWER" == *"dingin"* || "$DESC_LOWER" == *"cold"* ]]; then
                  WEATHER_CASUAL="dingin"
                elif [[ "$DESC_LOWER" == *"sejuk"* || "$DESC_LOWER" == *"cool"* || "$DESC_LOWER" == *"adem"* ]]; then
                  WEATHER_CASUAL="sejuk"
                elif [[ "$DESC_LOWER" == *"berawan"* || "$DESC_LOWER" == *"cloudy"* ]]; then
                  WEATHER_CASUAL="berawan"
                elif [[ "$DESC_LOWER" == *"cerah"* || "$DESC_LOWER" == *"sunny"* || "$DESC_LOWER" == *"clear"* ]]; then
                  WEATHER_CASUAL="cerah"
                else
                  WEATHER_CASUAL="enak"
                fi
              fi
              
              if [[ -n "$TEMP" && -n "$WEATHER_CASUAL" ]]; then
                WEATHER_INFO="cuaca ${WEATHER_CASUAL} ${TEMP}¬∞c"
              elif [[ -n "$WEATHER_CASUAL" ]]; then
                WEATHER_INFO="cuaca ${WEATHER_CASUAL}"
              elif [[ -n "$TEMP" ]]; then
                WEATHER_INFO="${TEMP}¬∞c"
              fi
              
              echo "‚úÖ BMKG Weather: $WEATHER_INFO"
            else
              echo "‚ö†Ô∏è Could not extract weather data from BMKG response"
              WEATHER_INFO="cuaca enak"
            fi
          else
            echo "‚ùå BMKG API failed, using fallback"
            WEATHER_INFO="cuaca enak"
          fi
          
          echo "WEATHER_INFO=$WEATHER_INFO" >> $GITHUB_OUTPUT
          
          # Extract weather type for activity matching
          WEATHER_TYPE="normal"
          if [[ "$WEATHER_INFO" == *"hujan"* ]]; then
            WEATHER_TYPE="rainy"
          elif [[ "$WEATHER_INFO" == *"gerimis"* ]]; then
            WEATHER_TYPE="rainy"
          elif [[ "$WEATHER_INFO" == *"berawan"* ]]; then
            WEATHER_TYPE="cloudy"
          elif [[ "$WEATHER_INFO" == *"mendung"* ]]; then
            WEATHER_TYPE="cloudy"
          elif [[ "$WEATHER_INFO" == *"cerah"* ]]; then
            WEATHER_TYPE="sunny"
          elif [[ "$WEATHER_INFO" == *"panas"* ]]; then
            WEATHER_TYPE="sunny"
          fi
          
          echo "WEATHER_TYPE=$WEATHER_TYPE" >> $GITHUB_OUTPUT

      - name: Generate AI Greeting
        id: ai_generation
        run: |
          echo "ü§ñ Generating AI greeting..."
          
          cat > /tmp/prompt.txt << 'EOF'
          **role:** you are a hype admin for the indonesian gaming discord server "skye". your task is to write a daily greeting that feels authentic and engages the adult community.

          **context for this message:**
          * time: ${{ steps.context.outputs.TYPE }}
          * day type: ${{ steps.context.outputs.CONTEXT }}
          * weather: ${{ steps.weather.outputs.WEATHER_INFO }}

          **CRITICAL FORMAT REQUIREMENT - FOLLOW EXACTLY:**
          You MUST write exactly TWO sentences:
          1. FIRST sentence: 100% English - start with hype opener, ask question
          2. SECOND sentence: 80% Indonesian with some English game terms - start with invitation word

          **hard rules**
          1. write exactly two sentences total separated by space
          2. sentence one is one hundred percent english
          3. sentence two is about eighty percent indonesian you may mix game names or gamer slang in english
          4. all lowercase only max two emojis if they fit
          5. mild friendly toxicity allowed but keep it chill
          6. if day type is weekend include the role tag <@&1374047008829997157> inside sentence two naturally on weekday do not include any tag the sentence structure must stay identical
          7. weave weather naturally as a reason in sentence two
          8. never use any dash characters in the generated message this includes minus hyphen and long dash
          9. keep it creative and avoid repeating patterns
          10. IMPORTANT: Weather context must match activity suggestions:
              - For rainy/drizzly weather: Suggest indoor activities like voice chat, gaming sessions, watching movies, etc.
              - For sunny/clear weather: Suggest outdoor activities when appropriate (morning walks, meetups, etc.)
              - For cloudy weather: Suggest flexible activities that work indoors or outdoors
              - Make sure the activity suggestion logically connects with the weather mentioned

          **sentence one structure in english:**
          * start with a hype opener: yoooo wasuiiip heyyy sup oi ayokkk yo team aight okay heads up
          * ask a specific question about their current vibe or activity that matches time
          * keep it punchy around ten to eighteen words
          * end with question mark

          **sentence two structure in indonesian:**
          * start with invitation word: yuk gas ayo pada mau siapa mau
          * suggest an activity that fits both time AND weather (indoor for rain, outdoor for clear when appropriate)
          * weave weather as the reason for the suggested activity
          * if weekend insert role tag naturally inside this sentence

          **YOU MUST OUTPUT BOTH SENTENCES - DO NOT OUTPUT ONLY ONE SENTENCE**

          **correct example format:**
          heyyy morning squad, coffee or controller which quest are you speedrunning before life aggro hits? yuk ngopi dulu sambil warm up aim lima belas menit, cuaca cerah bikin fokus jadi ayo colong daily üéÆ
          EOF
          
          AI_SUCCESS=false
          
          python3 << 'PYTHON_EOF'
          import json
          import requests
          import os
          import sys
          import re
          
          try:
              with open('/tmp/prompt.txt', 'r') as f:
                  prompt = f.read().strip()
              
              api_key = os.environ.get('GEMINI_API_KEY')
              if not api_key:
                  sys.exit(1)
              
              url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent?key={api_key}"
              
              payload = {
                  "contents": [{"parts": [{"text": prompt}]}],
                  "generationConfig": {
                      "temperature": 0.85,
                      "maxOutputTokens": 200,
                      "topP": 0.9
                  }
              }
              
              response = requests.post(url, json=payload, timeout=25)
              
              if response.status_code == 200:
                  data = response.json()
                  if 'candidates' in data and len(data['candidates']) > 0:
                      ai_text = data['candidates'][0]['content']['parts'][0]['text'].strip()
                      
                      # Clean and extract the message
                      clean_text = re.sub(r'\*\*([^*]+)\*\*', r'\1', ai_text)
                      clean_text = re.sub(r'\*([^*]+)\*', r'\1', clean_text)
                      clean_text = re.sub(r'`([^`]+)`', r'\1', clean_text)
                      
                      # Find the best line (longest substantial content)
                      lines = [line.strip() for line in clean_text.split('\n') if line.strip()]
                      best_line = ""
                      
                      for line in lines:
                          if (len(line) > 30 and 
                              not line.startswith(('**', '#', '-', '*', 'Context:', 'Weather:', 'SENTENCE', 'TIME-BASED')) and
                              not line.lower().startswith(('greeting:', 'message:', 'response:', 'output:'))):
                              if len(line) > len(best_line):
                                  best_line = line
                      
                      if best_line:
                          with open('/tmp/ai_response.txt', 'w', encoding='utf-8') as f:
                              f.write(best_line)
                          print("‚úÖ AI generation successful")
                          sys.exit(0)
              
              sys.exit(1)
              
          except Exception as e:
              print(f"‚ùå AI generation failed: {e}")
              sys.exit(1)
          PYTHON_EOF
          
          if [[ $? -eq 0 && -s /tmp/ai_response.txt ]]; then
            AI_TEXT=$(cat /tmp/ai_response.txt)
            WEATHER_MENTION="${{ steps.weather.outputs.WEATHER_INFO }}"
            WEATHER_TYPE="${{ steps.weather.outputs.WEATHER_TYPE }}"
            echo "üéØ AI generated: $AI_TEXT"
            
            # Strict validation for proper 2-sentence English-Indonesian structure
            SENTENCE_COUNT=$(echo "$AI_TEXT" | grep -o '[.!?]' | wc -l)
            
            # Check for English greeting at the start
            HAS_ENGLISH_START=$(echo "$AI_TEXT" | grep -iE "^(yooo|wassup|heyyyy|sup|ayooo|heyyy|oi|yo|aight|okay)")
            
            # Check for Indonesian invitation words  
            HAS_INDONESIAN=$(echo "$AI_TEXT" | grep -iE "(yuk|siapa mau|gas|ayo|pada mau)")
            
            # Check for gaming activities
            HAS_ACTIVITY=$(echo "$AI_TEXT" | grep -iE "(mabar|valo|valorant|ml|mobile legends|roblox|gaming|game|voice chat|push rank|nongkrong|begadang)")
            
            # Check for weather mention
            HAS_WEATHER=$(echo "$AI_TEXT" | grep -iE "(cuaca|hujan|gerimis|cerah|panas|dingin|sejuk|berawan|mendung)")
            
            # Check for proper sentence separation (. or ? followed by space and word)
            HAS_SENTENCE_BREAK=$(echo "$AI_TEXT" | grep -E '[.?]\s+[a-z]')
            
            # Weather context validation
            WEATHER_ACTIVITY_MATCH=true
            
            # Check for weather-appropriate activities
            if [[ "$WEATHER_TYPE" == "rainy" ]]; then
              # For rainy weather, should suggest indoor activities
              if [[ "$AI_TEXT" == *"jogging"* || "$AI_TEXT" == *"jalan-jalan"* || "$AI_TEXT" == *"olahraga pagi"* ]]; then
                WEATHER_ACTIVITY_MATCH=false
                echo "‚ö†Ô∏è Weather-activity mismatch: Outdoor activities suggested for rainy weather"
              fi
            fi
            
            # Strict validation - must have all components
            if [[ ${#AI_TEXT} -gt 70 && ${#AI_TEXT} -lt 280 && $SENTENCE_COUNT -ge 2 && -n "$HAS_ENGLISH_START" && -n "$HAS_INDONESIAN" && -n "$HAS_ACTIVITY" && -n "$HAS_WEATHER" && -n "$HAS_SENTENCE_BREAK" && "$WEATHER_ACTIVITY_MATCH" == "true" ]]; then
              DESC_RAW="$AI_TEXT"
              USE_AI=true
              echo "‚úÖ AI validated: ${#AI_TEXT} chars, proper English-Indonesian structure with weather-appropriate activities"
            else
              echo "‚ö†Ô∏è AI validation failed: ${#AI_TEXT} chars"
              echo "   English start: ${HAS_ENGLISH_START:-missing}"
              echo "   Indonesian: ${HAS_INDONESIAN:-missing}" 
              echo "   Activity: ${HAS_ACTIVITY:-missing}"
              echo "   Weather: ${HAS_WEATHER:-missing}"
              echo "   Sentence break: ${HAS_SENTENCE_BREAK:-missing}"
              echo "   Weather-activity match: $WEATHER_ACTIVITY_MATCH"
              echo "   Sentence count: $SENTENCE_COUNT"
              echo "   Raw text: $AI_TEXT"
              USE_AI=false
            fi
          else
            echo "‚ùå AI generation failed, using fallback"
            USE_AI=false
          fi
          
          if [[ "$USE_AI" != "true" ]]; then
            echo "üé≤ Using enhanced fallback system..."
            
            WEATHER_MENTION="${{ steps.weather.outputs.WEATHER_INFO }}"
            WEATHER_TYPE="${{ steps.weather.outputs.WEATHER_TYPE }}"
            declare -a MESSAGES
            
            case "${{ steps.context.outputs.TYPE }}" in
              "morning")
                if [[ "$WEATHER_TYPE" == "rainy" ]]; then
                  MESSAGES=(
                    "yooooo morning squad, how's everyone feeling with this rainy start? yuk <@&1374047008829997157> ngumpul di voice chat sambil sarapan bareng, ${WEATHER_MENTION} perfect buat santai di dalam rumah!"
                    "wassuppp early birds, getting cozy with the rain sounds? siapa mau <@&1374047008829997157> main game sambil ngopi hangat, ${WEATHER_MENTION} bikin betah di rumah!"
                    "heyyyy morning legends, rain keeping you in bed or already up grinding? gas <@&1374047008829997157> mabar game sambil dengerin musik, ${WEATHER_MENTION} enak banget buat indoor gaming!"
                    "sup good morning gamers, rain hitting your windows making that perfect ambience? yuk <@&1374047008829997157> main roblox sambil sarapan, ${WEATHER_MENTION} bikin perfect buat grinding di dalam!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo morning squad, how's everyone feeling with this rainy start? yuk ngumpul di voice chat sambil sarapan bareng, ${WEATHER_MENTION} perfect buat santai di dalam rumah!"
                      "wassuppp early birds, getting cozy with the rain sounds? siapa mau main game sambil ngopi hangat, ${WEATHER_MENTION} bikin betah di rumah!"
                      "heyyyy morning legends, rain keeping you in bed or already up grinding? gas mabar game sambil dengerin musik, ${WEATHER_MENTION} enak banget buat indoor gaming!"
                      "sup good morning gamers, rain hitting your windows making that perfect ambience? yuk main roblox sambil sarapan, ${WEATHER_MENTION} bikin perfect buat grinding di dalam!"
                    )
                  fi
                elif [[ "$WEATHER_TYPE" == "cloudy" ]]; then
                  MESSAGES=(
                    "yooooo morning squad, cloudy vibes got you feeling chill or sleepy? yuk <@&1374047008829997157> jalan santai sambil ngopi pagi, ${WEATHER_MENTION} enak buat aktivitas ringan!"
                    "wassuppp early birds, energy level gimana with these clouds? siapa mau <@&1374047008829997157> workout ringan di teras terus sarapan bareng, ${WEATHER_MENTION} adem gak panas!"
                    "heyyyy morning legends, cloudy start making you productive or lazy? gas <@&1374047008829997157> planning day ini sambil nongkrong santai, ${WEATHER_MENTION} nyaman buat ngobrol!"
                    "sup good morning gamers, cloudy weather got you in that perfect mood? yuk <@&1374047008829997157> light stretching dulu terus gaming session, ${WEATHER_MENTION} pas banget buat fokus!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo morning squad, cloudy vibes got you feeling chill or sleepy? yuk jalan santai sambil ngopi pagi, ${WEATHER_MENTION} enak buat aktivitas ringan!"
                      "wassuppp early birds, energy level gimana with these clouds? siapa mau workout ringan di teras terus sarapan bareng, ${WEATHER_MENTION} adem gak panas!"
                      "heyyyy morning legends, cloudy start making you productive or lazy? gas planning day ini sambil nongkrong santai, ${WEATHER_MENTION} nyaman buat ngobrol!"
                      "sup good morning gamers, cloudy weather got you in that perfect mood? yuk light stretching dulu terus gaming session, ${WEATHER_MENTION} pas banget buat fokus!"
                    )
                  fi
                else
                  MESSAGES=(
                    "yooooo morning squad, sunshine energy flowing through yet? yuk <@&1374047008829997157> jogging pagi terus sarapan bareng, ${WEATHER_MENTION} perfect buat outdoor activity!"
                    "wassuppp early birds, feeling that morning freshness? siapa mau <@&1374047008829997157> olahraga ringan di taman terus main roblox, ${WEATHER_MENTION} cerah bikin semangat!"
                    "heyyyy morning legends, day looking bright or still sleepy mode? gas <@&1374047008829997157> jalan-jalan pagi terus mampir kedai kopi, ${WEATHER_MENTION} enak banget buat keluar!"
                    "sup good morning gamers, ready to conquer this bright day? yuk <@&1374047008829997157> morning routine di luar terus gaming session, ${WEATHER_MENTION} bikin fresh!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo morning squad, sunshine energy flowing through yet? yuk jogging pagi terus sarapan bareng, ${WEATHER_MENTION} perfect buat outdoor activity!"
                      "wassuppp early birds, feeling that morning freshness? siapa mau olahraga ringan di taman terus main roblox, ${WEATHER_MENTION} cerah bikin semangat!"
                      "heyyyy morning legends, day looking bright or still sleepy mode? gas jalan-jalan pagi terus mampir kedai kopi, ${WEATHER_MENTION} enak banget buat keluar!"
                      "sup good morning gamers, ready to conquer this bright day? yuk morning routine di luar terus gaming session, ${WEATHER_MENTION} bikin fresh!"
                    )
                  fi
                fi
                ;;
              "afternoon")
                if [[ "$WEATHER_TYPE" == "rainy" ]]; then
                  MESSAGES=(
                    "yooooo afternoon vibes, rain making you sleepy or extra focused? yuk <@&1374047008829997157> voice chat sambil mabar valo, ${WEATHER_MENTION} perfect buat gaming marathon di dalam!"
                    "wassuppp midday squad, rain hitting hard outside? siapa mau <@&1374047008829997157> nonton film bareng di discord, ${WEATHER_MENTION} cocok buat indoor chill!"
                    "heyyyy afternoon legends, lunch done while watching the rain? gas <@&1374047008829997157> push rank ml sambil santai di rumah, ${WEATHER_MENTION} enak banget buat fokus gaming!"
                    "sup afternoon crew, rain got you in that perfect gaming mood? ayo <@&1374047008829997157> hangout di voice channel sambil grinding, ${WEATHER_MENTION} bikin betah di dalam ruangan!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo afternoon vibes, rain making you sleepy or extra focused? yuk voice chat sambil mabar valo, ${WEATHER_MENTION} perfect buat gaming marathon di dalam!"
                      "wassuppp midday squad, rain hitting hard outside? siapa mau nonton film bareng di discord, ${WEATHER_MENTION} cocok buat indoor chill!"
                      "heyyyy afternoon legends, lunch done while watching the rain? gas push rank ml sambil santai di rumah, ${WEATHER_MENTION} enak banget buat fokus gaming!"
                      "sup afternoon crew, rain got you in that perfect gaming mood? ayo hangout di voice channel sambil grinding, ${WEATHER_MENTION} bikin betah di dalam ruangan!"
                    )
                  fi
                elif [[ "$WEATHER_TYPE" == "cloudy" ]]; then
                  MESSAGES=(
                    "yooooo afternoon vibes, clouds giving you that perfect gaming light? yuk <@&1374047008829997157> makan siang bareng terus mabar ml, ${WEATHER_MENTION} enak buat santai!"
                    "wassuppp midday squad, enjoying the cool cloudy afternoon? siapa mau <@&1374047008829997157> jalan ke cafe terus gaming mobile, ${WEATHER_MENTION} pas banget gak panas!"
                    "heyyyy afternoon legends, feeling those chill cloudy vibes? gas <@&1374047008829997157> nongkrong santai sambil main roblox, ${WEATHER_MENTION} adem buat hangout!"
                    "sup afternoon crew, clouds making the perfect afternoon ambience? ayo <@&1374047008829997157> ke mall sambil planning mabar nanti malem, ${WEATHER_MENTION} enak buat jalan-jalan!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo afternoon vibes, clouds giving you that perfect gaming light? yuk makan siang bareng terus mabar ml, ${WEATHER_MENTION} enak buat santai!"
                      "wassuppp midday squad, enjoying the cool cloudy afternoon? siapa mau jalan ke cafe terus gaming mobile, ${WEATHER_MENTION} pas banget gak panas!"
                      "heyyyy afternoon legends, feeling those chill cloudy vibes? gas nongkrong santai sambil main roblox, ${WEATHER_MENTION} adem buat hangout!"
                      "sup afternoon crew, clouds making the perfect afternoon ambience? ayo planning mabar nanti malem sambil makan siang, ${WEATHER_MENTION} enak buat istirahat sejenak!"
                    )
                  fi
                else
                  MESSAGES=(
                    "yooooo afternoon vibes, sun shining on your gaming setup? yuk <@&1374047008829997157> makan siang di outdoor spot terus mabar, ${WEATHER_MENTION} enak buat jalan keluar!"
                    "wassuppp midday squad, feeling energized by the sun? siapa mau <@&1374047008829997157> mampir ke taman sambil chill gaming, ${WEATHER_MENTION} cerah perfect buat aktivitas outdoor!"
                    "heyyyy afternoon legends, tan lines or screen time this sunny day? gas <@&1374047008829997157> jalan-jalan sore terus nongkrong, ${WEATHER_MENTION} bagus buat keluar sebentar!"
                    "sup afternoon crew, sunshine making you active or wanting shade? ayo <@&1374047008829997157> hangout di cafe outdoor sambil main mobile games, ${WEATHER_MENTION} cerah ceria!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo afternoon vibes, sun shining on your gaming setup? yuk makan siang di outdoor spot terus mabar, ${WEATHER_MENTION} enak buat jalan keluar!"
                      "wassuppp midday squad, feeling energized by the sun? siapa mau mampir ke taman sambil chill gaming, ${WEATHER_MENTION} cerah perfect buat aktivitas outdoor!"
                      "heyyyy afternoon legends, tan lines or screen time this sunny day? gas jalan-jalan sore terus nongkrong, ${WEATHER_MENTION} bagus buat keluar sebentar!"
                      "sup afternoon crew, sunshine making you active or wanting shade? ayo hangout di cafe outdoor sambil main mobile games, ${WEATHER_MENTION} cerah ceria!"
                    )
                  fi
                fi
                ;;
              "evening")
                if [[ "$WEATHER_TYPE" == "rainy" ]]; then
                  MESSAGES=(
                    "yooooo evening squad, rain setting that perfect gaming mood? yuk <@&1374047008829997157> voice chat sambil dinner delivery, ${WEATHER_MENTION} bikin perfect buat mabar di rumah!"
                    "wassuppp golden hour gang, rain keeping you indoors tonight? siapa mau <@&1374047008829997157> movie night di discord sambil gaming breaks, ${WEATHER_MENTION} cocok banget buat cozy night in!"
                    "heyyyy evening legends, rain soundtrack hitting different tonight? gas <@&1374047008829997157> mabar valo tournament kita sendiri, ${WEATHER_MENTION} bikin fokus maksimal di dalam!"
                    "sup evening mood check, cozy with the rain sounds? yuk <@&1374047008829997157> makan malam delivery terus marathon gaming, ${WEATHER_MENTION} perfect buat stay home activities!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo evening squad, rain setting that perfect gaming mood? yuk voice chat sambil dinner delivery, ${WEATHER_MENTION} bikin perfect buat mabar di rumah!"
                      "wassuppp golden hour gang, rain keeping you indoors tonight? siapa mau movie night di discord sambil gaming breaks, ${WEATHER_MENTION} cocok banget buat cozy night in!"
                      "heyyyy evening legends, rain soundtrack hitting different tonight? gas mabar valo tournament kita sendiri, ${WEATHER_MENTION} bikin fokus maksimal di dalam!"
                      "sup evening mood check, cozy with the rain sounds? yuk makan malam delivery terus marathon gaming, ${WEATHER_MENTION} perfect buat stay home activities!"
                    )
                  fi
                elif [[ "$WEATHER_TYPE" == "cloudy" ]]; then
                  MESSAGES=(
                    "yooooo evening squad, clouds making that perfect dim gaming light? yuk <@&1374047008829997157> makan malem di restoran terus lanjut discord, ${WEATHER_MENTION} enak buat keluar sebentar!"
                    "wassuppp golden hour gang, cloudy evening got you in the mood? siapa mau <@&1374047008829997157> jalan-jalan sore sambil planning mabar, ${WEATHER_MENTION} adem banget nih!"
                    "heyyyy evening legends, clouds bringing the chill evening vibes? gas <@&1374047008829997157> nongkrong di cafe terus mabar mobile, ${WEATHER_MENTION} nyaman buat hangout!"
                    "sup evening mood check, feeling the cloudy evening energy? yuk <@&1374047008829997157> dinner bareng terus voice chat session, ${WEATHER_MENTION} perfect buat aktivitas fleksibel!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo evening squad, clouds making that perfect dim gaming light? yuk makan malem di restoran terus lanjut discord, ${WEATHER_MENTION} enak buat keluar sebentar!"
                      "wassuppp golden hour gang, cloudy evening got you in the mood? siapa mau jalan-jalan sore sambil planning mabar, ${WEATHER_MENTION} adem banget nih!"
                      "heyyyy evening legends, clouds bringing the chill evening vibes? gas nongkrong di cafe terus mabar mobile, ${WEATHER_MENTION} nyaman buat hangout!"
                      "sup evening mood check, feeling the cloudy evening energy? yuk dinner bareng terus voice chat session, ${WEATHER_MENTION} perfect buat aktivitas fleksibel!"
                    )
                  fi
                else
                  MESSAGES=(
                    "yooooo evening squad, clear skies making for a perfect night? yuk <@&1374047008829997157> dinner di tempat outdoor terus lanjut gaming, ${WEATHER_MENTION} enak buat keluar malam ini!"
                    "wassuppp golden hour gang, sunset looking perfect for an evening out? siapa mau <@&1374047008829997157> jalan-jalan malam terus nongkrong sambil main game, ${WEATHER_MENTION} bagus banget buat aktivitas outdoor!"
                    "heyyyy evening legends, stars visible yet on this clear night? gas <@&1374047008829997157> makan malem di rooftop terus mabar, ${WEATHER_MENTION} pas buat hangout outdoor!"
                    "sup evening mood check, night air feeling refreshing? yuk <@&1374047008829997157> hangout di outdoor cafe terus voice chat, ${WEATHER_MENTION} enak buat keluar rumah sejenak!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo evening squad, clear skies making for a perfect night? yuk dinner di tempat outdoor terus lanjut gaming, ${WEATHER_MENTION} enak buat keluar malam ini!"
                      "wassuppp golden hour gang, sunset looking perfect for an evening out? siapa mau jalan-jalan malam terus nongkrong sambil main game, ${WEATHER_MENTION} bagus banget buat aktivitas outdoor!"
                      "heyyyy evening legends, stars visible yet on this clear night? gas makan malem di rooftop terus mabar, ${WEATHER_MENTION} pas buat hangout outdoor!"
                      "sup evening mood check, night air feeling refreshing? yuk hangout di outdoor cafe terus voice chat, ${WEATHER_MENTION} enak buat keluar rumah sejenak!"
                    )
                  fi
                fi
                ;;
              "night")
                if [[ "$WEATHER_TYPE" == "rainy" ]]; then
                  MESSAGES=(
                    "yooooo night owls, rain making that perfect sleep ambience but you're gaming instead? perfect time <@&1374047008829997157> begadang voice chat sambil mabar, ${WEATHER_MENTION} bikin fokus maksimal di dalam!"
                    "wassuppp midnight squad, rain hitting your roof while you grind? siapa mau <@&1374047008829997157> marathon horror games sambil dengerin hujan, ${WEATHER_MENTION} setting sempurna buat gaming malam di rumah!"
                    "heyyyy nocturnal gamers, rain drops becoming your gaming soundtrack? gas <@&1374047008829997157> push rank ml sambil makan snack, ${WEATHER_MENTION} bikin betah begadang di dalam!"
                    "sup late night legends, rain got you in that perfect focus zone? ayo <@&1374047008829997157> movie marathon di discord sambil gaming breaks, ${WEATHER_MENTION} cocok banget buat activities indoor!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo night owls, rain making that perfect sleep ambience but you're gaming instead? perfect time begadang voice chat sambil mabar, ${WEATHER_MENTION} bikin fokus maksimal di dalam!"
                      "wassuppp midnight squad, rain hitting your roof while you grind? siapa mau marathon horror games sambil dengerin hujan, ${WEATHER_MENTION} setting sempurna buat gaming malam di rumah!"
                      "heyyyy nocturnal gamers, rain drops becoming your gaming soundtrack? gas push rank ml sambil makan snack, ${WEATHER_MENTION} bikin betah begadang di dalam!"
                      "sup late night legends, rain got you in that perfect focus zone? ayo movie marathon di discord sambil gaming breaks, ${WEATHER_MENTION} cocok banget buat activities indoor!"
                    )
                  fi
                elif [[ "$WEATHER_TYPE" == "cloudy" ]]; then
                  MESSAGES=(
                    "yooooo night owls, moonlight through clouds creating perfect ambience? perfect time <@&1374047008829997157> begadang voice chat sambil grinding game favorit, ${WEATHER_MENTION} enak buat fokus malem-malem!"
                    "wassuppp midnight squad, night air feeling just right? siapa mau <@&1374047008829997157> marathon valo sampai pagi, ${WEATHER_MENTION} bikin betah buat gaming session panjang!"
                    "heyyyy nocturnal gamers, night bringing the best gaming energy? gas <@&1374047008829997157> push rank ml sambil ngobrol santai, ${WEATHER_MENTION} pas buat begadang produktif!"
                    "sup late night legends, peaceful night vibes hitting just right? ayo <@&1374047008829997157> voice chat sambil gaming marathon, ${WEATHER_MENTION} perfect buat night session!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo night owls, moonlight through clouds creating perfect ambience? perfect time begadang voice chat sambil grinding game favorit, ${WEATHER_MENTION} enak buat fokus malem-malem!"
                      "wassuppp midnight squad, night air feeling just right? siapa mau marathon valo sampai pagi, ${WEATHER_MENTION} bikin betah buat gaming session panjang!"
                      "heyyyy nocturnal gamers, night bringing the best gaming energy? gas push rank ml sambil ngobrol santai, ${WEATHER_MENTION} pas buat begadang produktif!"
                      "sup late night legends, peaceful night vibes hitting just right? ayo voice chat sambil gaming marathon, ${WEATHER_MENTION} perfect buat night session!"
                    )
                  fi
                else
                  MESSAGES=(
                    "yooooo night owls, clear night sky got you feeling zen while gaming? perfect time <@&1374047008829997157> stargazing break sambil voice chat, ${WEATHER_MENTION} bikin enak buat keluar sebentar!"
                    "wassuppp midnight squad, clear night giving you that perfect gaming focus? siapa mau <@&1374047008829997157> mabar di balkon sambil nikmatin malam, ${WEATHER_MENTION} pas banget buat chill gaming!"
                    "heyyyy nocturnal gamers, stars out bright tonight for your gaming session? gas <@&1374047008829997157> push rank ml sambil ngopi malam, ${WEATHER_MENTION} bikin betah begadang!"
                    "sup late night legends, clear night boosting your gaming performance? ayo <@&1374047008829997157> voice chat sambil gaming marathon, ${WEATHER_MENTION} enak buat night activities!"
                  )
                  if [[ "${{ steps.context.outputs.CONTEXT }}" != "weekend" ]]; then
                    MESSAGES=(
                      "yooooo night owls, clear night sky got you feeling zen while gaming? perfect time stargazing break sambil voice chat, ${WEATHER_MENTION} bikin enak buat keluar sebentar!"
                      "wassuppp midnight squad, clear night giving you that perfect gaming focus? siapa mau mabar di balkon sambil nikmatin malam, ${WEATHER_MENTION} pas banget buat chill gaming!"
                      "heyyyy nocturnal gamers, stars out bright tonight for your gaming session? gas push rank ml sambil ngopi malam, ${WEATHER_MENTION} bikin betah begadang!"
                      "sup late night legends, clear night boosting your gaming performance? ayo voice chat sambil gaming marathon, ${WEATHER_MENTION} enak buat night activities!"
                    )
                  fi
                fi
                ;;
            esac
            
            RANDOM_INDEX=$((RANDOM % ${#MESSAGES[@]}))
            DESC_RAW="${MESSAGES[$RANDOM_INDEX]}"
          fi
          
          declare -a TITLES
          declare -a THUMBS
          
          case "${{ steps.context.outputs.TYPE }}" in
            "morning") 
              TITLES=("‚òÄÔ∏è Good Morning, Skye Squad!" "üåÖ Rise and Shine, Skyers!" "‚òï Morning Vibes, Skye Squad!" "üåû Good Morning, Skyers!" "‚≠ê Fresh Morning, Skye Squad!")
              THUMBS=("2600" "1f305" "2615" "1f31e" "2b50")
              ;;
            "afternoon") 
              TITLES=("üçÉ Good Afternoon, Skye Squad!" "üå§Ô∏è Midday Check, Skyers!" "‚òÄÔ∏è Lunch Time, Skye Squad!" "üéØ Afternoon Gaming, Skyers!" "üíº Break Time, Skye Squad!")
              THUMBS=("1f343" "1f324" "2600" "1f3af" "1f4bc")
              ;;
            "evening") 
              TITLES=("üåá Good Evening, Skye Squad!" "üåÜ Golden Hour, Skyers!" "‚ú® Evening Chill, Skye Squad!" "üåÖ Sunset Gaming, Skyers!" "üéÆ Evening Session, Skye Squad!")
              THUMBS=("1f307" "1f307" "2728" "1f305" "1f3af")
              ;;
            "night") 
              TITLES=("ü¶â Good Night, Skye Squad!" "üåô Midnight Club, Skyers!" "‚≠ê Night Owls, Skye Squad!" "‚ú® Nocturnal Gaming, Skyers!" "üåü Late Night Crew, Skye Squad!")
              THUMBS=("1f989" "1f319" "2b50" "2728" "1f31f")
              ;;
          esac
          
          # Add weather-specific emojis to titles
          WEATHER_TYPE="${{ steps.weather.outputs.WEATHER_TYPE }}"
          if [[ "$WEATHER_TYPE" == "rainy" ]]; then
            case "${{ steps.context.outputs.TYPE }}" in
              "morning")
                TITLES=("üåßÔ∏è Good Morning, Skye Squad!" "‚òî Rise and Shine, Skyers!" "üå¶Ô∏è Rainy Morning, Skye Squad!" "üåßÔ∏è Good Morning, Skyers!" "‚òî Fresh Morning, Skye Squad!")
                THUMBS=("1f327" "2614" "1f326" "1f327" "2614")
                ;;
              "afternoon")
                TITLES=("üåßÔ∏è Good Afternoon, Skye Squad!" "‚òî Midday Check, Skyers!" "üå¶Ô∏è Rainy Lunch, Skye Squad!" "üåßÔ∏è Afternoon Gaming, Skyers!" "‚òî Break Time, Skye Squad!")
                THUMBS=("1f327" "2614" "1f326" "1f327" "2614")
                ;;
              "evening")
                TITLES=("üåßÔ∏è Good Evening, Skye Squad!" "‚òî Golden Hour, Skyers!" "üå¶Ô∏è Rainy Evening, Skye Squad!" "üåßÔ∏è Sunset Gaming, Skyers!" "‚òî Evening Session, Skye Squad!")
                THUMBS=("1f327" "2614" "1f326" "1f327" "2614")
                ;;
              "night")
                TITLES=("üåßÔ∏è Good Night, Skye Squad!" "‚òî Midnight Club, Skyers!" "üå¶Ô∏è Rainy Night, Skye Squad!" "üåßÔ∏è Nocturnal Gaming, Skyers!" "‚òî Late Night Crew, Skye Squad!")
                THUMBS=("1f327" "2614" "1f326" "1f327" "2614")
                ;;
            esac
          elif [[ "$WEATHER_TYPE" == "cloudy" ]]; then
            case "${{ steps.context.outputs.TYPE }}" in
              "morning")
                TITLES=("‚òÅÔ∏è Good Morning, Skye Squad!" "üå•Ô∏è Rise and Shine, Skyers!" "‚õÖ Cloudy Morning, Skye Squad!" "‚òÅÔ∏è Good Morning, Skyers!" "üå•Ô∏è Fresh Morning, Skye Squad!")
                THUMBS=("2601" "1f325" "26c5" "2601" "1f325")
                ;;
              "afternoon")
                TITLES=("‚òÅÔ∏è Good Afternoon, Skye Squad!" "üå•Ô∏è Midday Check, Skyers!" "‚õÖ Cloudy Lunch, Skye Squad!" "‚òÅÔ∏è Afternoon Gaming, Skyers!" "üå•Ô∏è Break Time, Skye Squad!")
                THUMBS=("2601" "1f325" "26c5" "2601" "1f325")
                ;;
              "evening")
                TITLES=("‚òÅÔ∏è Good Evening, Skye Squad!" "üå•Ô∏è Golden Hour, Skyers!" "‚õÖ Cloudy Evening, Skye Squad!" "‚òÅÔ∏è Sunset Gaming, Skyers!" "üå•Ô∏è Evening Session, Skye Squad!")
                THUMBS=("2601" "1f325" "26c5" "2601" "1f325")
                ;;
              "night")
                TITLES=("‚òÅÔ∏è Good Night, Skye Squad!" "üå•Ô∏è Midnight Club, Skyers!" "‚õÖ Cloudy Night, Skye Squad!" "‚òÅÔ∏è Nocturnal Gaming, Skyers!" "üå•Ô∏è Late Night Crew, Skye Squad!")
                THUMBS=("2601" "1f325" "26c5" "2601" "1f325")
                ;;
            esac
          elif [[ "$WEATHER_TYPE" == "sunny" ]]; then
            case "${{ steps.context.outputs.TYPE }}" in
              "morning")
                TITLES=("‚òÄÔ∏è Good Morning, Skye Squad!" "üåû Rise and Shine, Skyers!" "üåà Sunny Morning, Skye Squad!" "‚òÄÔ∏è Good Morning, Skyers!" "üåû Fresh Morning, Skye Squad!")
                THUMBS=("2600" "1f31e" "1f308" "2600" "1f31e")
                ;;
              "afternoon")
                TITLES=("‚òÄÔ∏è Good Afternoon, Skye Squad!" "üåû Midday Check, Skyers!" "üåà Sunny Lunch, Skye Squad!" "‚òÄÔ∏è Afternoon Gaming, Skyers!" "üåû Break Time, Skye Squad!")
                THUMBS=("2600" "1f31e" "1f308" "2600" "1f31e")
                ;;
              "evening")
                TITLES=("‚òÄÔ∏è Good Evening, Skye Squad!" "üåû Golden Hour, Skyers!" "üåà Sunny Evening, Skye Squad!" "‚òÄÔ∏è Sunset Gaming, Skyers!" "üåû Evening Session, Skye Squad!")
                THUMBS=("2600" "1f31e" "1f308" "2600" "1f31e")
                ;;
              "night")
                TITLES=("üåô Good Night, Skye Squad!" "‚ú® Midnight Club, Skyers!" "‚≠ê Clear Night, Skye Squad!" "üåÉ Nocturnal Gaming, Skyers!" "üåü Late Night Crew, Skye Squad!")
                THUMBS=("1f319" "2728" "2b50" "1f303" "1f31f")
                ;;
            esac
          fi
          
          RANDOM_INDEX=$((RANDOM % ${#TITLES[@]}))
          TITLE="${TITLES[$RANDOM_INDEX]}"
          THUMB="${THUMBS[$RANDOM_INDEX]}"
          
          echo "TITLE=$TITLE" >> $GITHUB_OUTPUT
          echo "DESC_RAW=$DESC_RAW" >> $GITHUB_OUTPUT
          echo "USE_AI=$USE_AI" >> $GITHUB_OUTPUT
          echo "THUMB=$THUMB" >> $GITHUB_OUTPUT
          
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      - name: Send Discord Message
        if: ${{ github.event.inputs.test_mode != 'true' }}
        run: |
          echo "üì§ Sending Discord message..."
          
          case "${{ steps.context.outputs.TYPE }}" in
            "morning") COLOR=16766720 ;;
            "afternoon") COLOR=16763904 ;;
            "evening") COLOR=16744448 ;;
            "night") COLOR=8947848 ;;
          esac
          
          TITLE="${{ steps.ai_generation.outputs.TITLE }}"
          DESC="${{ steps.ai_generation.outputs.DESC_RAW }}"
          THUMB="${{ steps.ai_generation.outputs.THUMB }}"
          TIMESTAMP=$(TZ='Asia/Jakarta' date -u +%Y-%m-%dT%H:%M:%S.000Z)
          
          python3 << 'PYTHON_EOF'
          import json
          import os
          
          title = os.environ.get('TITLE', 'Skye Squad')
          desc_raw = os.environ.get('DESC', 'what\'s good everyone!')
          color = int(os.environ.get('COLOR', '16766720'))
          timestamp = os.environ.get('TIMESTAMP', '')
          thumb = os.environ.get('THUMB', '1f305')
          context = os.environ.get('CONTEXT', 'weekday')
          
          # Convert description to lowercase
          desc = desc_raw.lower()
          
          # Weekend role tagging is handled in AI prompt and fallback messages
          # No additional processing needed here since it's already included
          
          desc += "\n> by server dev guanteng - <@399393175904714752>"
          
          embed = {
              "title": title,
              "description": desc,
              "color": color,
              "thumbnail": {
                  "url": f"https://twemoji.maxcdn.com/v/latest/72x72/{thumb}.png"
              },
              "footer": {
                  "text": "chill gaming vibes",
                  "icon_url": "https://files.catbox.moe/npfh4e.jpg"
              },
              "timestamp": timestamp
          }
          
          payload = {"embeds": [embed]}
          
          with open('/tmp/discord_payload.json', 'w', encoding='utf-8') as f:
              json.dump(payload, f, ensure_ascii=False)
          
          print("‚úÖ Payload created")
          PYTHON_EOF
          
          curl -f -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
               -H "Content-Type: application/json" \
               --data-binary @/tmp/discord_payload.json
          
          echo "‚úÖ Message sent!"
          echo "ü§ñ AI Used: ${{ steps.ai_generation.outputs.USE_AI }}"
          
        env:
          TITLE: ${{ steps.ai_generation.outputs.TITLE }}
          DESC: ${{ steps.ai_generation.outputs.DESC_RAW }}
          COLOR: ${{ env.COLOR }}
          TIMESTAMP: ${{ env.TIMESTAMP }}
          THUMB: ${{ steps.ai_generation.outputs.THUMB }}
          CONTEXT: ${{ steps.context.outputs.CONTEXT }}

      - name: Test Mode Output
        if: ${{ github.event.inputs.test_mode == 'true' }}
        run: |
          echo "üß™ TEST MODE - Message preview:"
          echo "================================"
          echo "Title: ${{ steps.ai_generation.outputs.TITLE }}"
          echo "Description: ${{ steps.ai_generation.outputs.DESC_RAW }}"
          echo "AI Used: ${{ steps.ai_generation.outputs.USE_AI }}"
          echo "Weather: ${{ steps.weather.outputs.WEATHER_INFO }}"
          echo "Context: ${{ steps.context.outputs.TYPE }} (${{ steps.context.outputs.SPECIAL_CONTEXT }})"
          echo "OpenWrt Mode: ${{ steps.context.outputs.OPENWRT_MODE }}"
          echo "================================"
          echo "üß™ Test complete - no message sent"

      - name: Send Random Sticker
        if: ${{ github.event.inputs.test_mode != 'true' }}
        run: |
          echo "üé≤ Sending random sticker..."
          
          if [[ "${{ steps.context.outputs.OPENWRT_MODE }}" == "true" ]]; then
            echo "üè† OpenWrt mode - sending sticker immediately"
            sleep 1
          else
            echo "‚è∞ Standard delay for sticker..."
            sleep 3
          fi
          
          case "${{ steps.context.outputs.TYPE }}" in
            "morning")
              STICKERS=(
                "https://media.discordapp.net/stickers/1404543938815197306.png"
                "https://media.discordapp.net/stickers/1405277985237368943.png"
                "https://media.discordapp.net/stickers/1405477154095104082.png"
              )
              ;;
            "afternoon")
              STICKERS=(
                "https://media.discordapp.net/stickers/1405487683526201404.png"
                "https://media.discordapp.net/stickers/1405546781927936051.png"
                "https://media.discordapp.net/stickers/1405855503858274397.png"
              )
              ;;
            "evening")
              STICKERS=(
                "https://media.discordapp.net/stickers/1405914196922597549.png"
                "https://media.discordapp.net/stickers/1406065324758929509.png"
                "https://media.discordapp.net/stickers/1406629592839491716.png"
              )
              ;;
            "night")
              STICKERS=(
                "https://media.discordapp.net/stickers/1406668584335184003.png"
                "https://media.discordapp.net/stickers/1407858067013369856.png"
                "https://media.discordapp.net/stickers/1407858350334677204.png"
                "https://media.discordapp.net/stickers/1407858765616779396.png"
                "https://media.discordapp.net/stickers/1407859373396590735.png"
              )
              ;;
          esac
          
          RANDOM_INDEX=$((RANDOM % ${#STICKERS[@]}))
          SELECTED_STICKER=${STICKERS[$RANDOM_INDEX]}
          
          curl -f -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
               -H "Content-Type: application/json" \
               -d "{\"content\":\"$SELECTED_STICKER\"}"
          
          echo "üéâ Sticker sent!"

      - name: Execution Summary
        run: |
          echo "üìä EXECUTION SUMMARY"
          echo "================================"
          echo "üïê Time: ${{ steps.context.outputs.CURRENT_TIME }} WIB (${{ steps.context.outputs.CURRENT_DAY }})"
          echo "üéØ Type: ${{ steps.context.outputs.TYPE }} (${{ steps.context.outputs.CONTEXT }})"
          echo "üå§Ô∏è Weather: ${{ steps.weather.outputs.WEATHER_INFO }}"
          echo "ü§ñ AI Success: ${{ steps.ai_generation.outputs.USE_AI }}"
          echo "üè† OpenWrt Mode: ${{ steps.context.outputs.OPENWRT_MODE }}"
          echo "üß™ Test Mode: ${{ github.event.inputs.test_mode }}"
          echo "================================"
          echo "‚úÖ Skye community greeting complete!"