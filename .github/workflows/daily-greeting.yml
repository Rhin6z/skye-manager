name: daily discord greeting â€” rotating (english-first)

on:
  schedule:
    # 07:00 WIB (00:00 UTC)
    - cron: '0 0 * * 1-5'
    # 12:00 WIB (05:00 UTC)
    - cron: '0 5 * * 1-5'
    # 17:00 WIB (10:00 UTC)
    - cron: '0 10 * * 1-5'
    # 22:00 WIB (15:00 UTC)
    - cron: '0 15 * * 1-5'

  workflow_dispatch:
    inputs:
      greeting_type:
        description: 'select greeting type'
        required: true
        default: 'morning'
        type: choice
        options:
          - morning
          - afternoon
          - evening
          - night

jobs:
  send-greeting:
    runs-on: ubuntu-latest
    steps:

      - name: send morning greeting (rotating)
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.greeting_type == 'morning' || github.event.schedule == '0 0 * * 1-5' }}
        run: |
          set -euo pipefail
          
          # Arrays
          titles=("ðŸŒ… good morning, gng" "ðŸŒ… morning check-in" "ðŸŒ… hey, welcome in")
          descs=("[haloww chatt]\\n\\nlowkey warm-up: pick 1 tiny win to start.\\n\\n> lezgoo." "[pagiii gng]\\n\\nsip coffee, set intention.\\n\\n> small steps." "[yaa, morning fam]\\n\\nnew day, new reps.\\n\\n> steady.")
          footers=("warm start, clean slate" "sip kopi, ship kode" "light focus, strong flow")
          
          # Get random index
          idx=$((RANDOM % ${#titles[@]}))
          
          # Build JSON string directly
          json="{\"embeds\":[{\"title\":\"${titles[$idx]}\",\"description\":\"${descs[$idx]}\",\"color\":16766720,\"thumbnail\":{\"url\":\"https://cdn.discordapp.com/emojis/692428734822645770.gif\"},\"footer\":{\"text\":\"${footers[$idx]}\",\"icon_url\":\"https://cdn.discordapp.com/emojis/692428869338931240.png\"},\"timestamp\":\"$(date -u +%Y-%m-%dT%H:%M:%S.000Z)\"}]}"
          
          # Send to Discord
          curl -sS -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
            -H "Content-Type: application/json" \
            -d "$json"

      - name: send afternoon greeting (rotating)
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.greeting_type == 'afternoon' || github.event.schedule == '0 5 * * 1-5' }}
        run: |
          set -euo pipefail
          TS="$(date -u +%Y-%m-%dT%H:%M:%S.000Z)"

          titles=("ðŸŒž midday boost" "ðŸŒž afternoon check-in" "ðŸŒž keep the pace" "ðŸŒž lunch & launch")
          descs=(
            "[udah lunch? minum dulu, gng]\\n\\nlock 25-min focus, then breathe. satu progress bermakna > lima tab random.\\n\\n> keep it rolling, pelan tapi nancep."
            "[halo halo, siang dulu nih]\\n\\nwhatâ€™s your one thing before break? drop it â€” kita dorong bareng.\\n\\n> less noise, more signal."
            "[lanjut tipis tipis ya]\\n\\nstretch, refill water, ship a tiny update â€” ong.\\n\\n> progress > perfection."
            "[ayo ayo, power hour dikit]\\n\\nno doomscroll, just one clean commit â€” bet.\\n\\n> ship small, ship often."
          )
          footers=("hydrate, then iterate" "focus beats frenzy" "move kind, move forward" "snack, stack, ship")

          idx=$((RANDOM % ${#titles[@]}))
          export TITLE="${titles[$idx]}" DESC="${descs[$idx]}" FOOT="${footers[$idx]}" COLOR=16763904 TS

          # Simplified JSON generation without heredoc
          python3 -c '
import json, os
payload = {
    "embeds": [{
        "title": os.environ["TITLE"],
        "description": os.environ["DESC"],
        "color": int(os.environ["COLOR"]),
        "thumbnail": {"url": "https://cdn.discordapp.com/emojis/692428734822645770.gif"},
        "footer": {"text": os.environ["FOOT"], "icon_url": "https://cdn.discordapp.com/emojis/692428869338931240.png"},
        "timestamp": os.environ["TS"]
    }]
}
with open("payload.json", "w") as f:
    json.dump(payload, f)
'
          curl -sS -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" -H "content-type: application/json" --data @payload.json

      - name: send evening greeting (rotating)
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.greeting_type == 'evening' || github.event.schedule == '0 10 * * 1-5' }}
        run: |
          set -euo pipefail
          TS="$(date -u +%Y-%m-%dT%H:%M:%S.000Z)"

          titles=("ðŸŒ† evening check-in" "ðŸŒ† golden hour hello" "ðŸŒ† wrap-up together" "ðŸŒ† sunset sync")
          descs=(
            "[gimana harinya? cerita dikit yuk]\\n\\nwrap one loose end biar besok startnya ringan â€” done, pending, next.\\n\\n> proud of you, keep going."
            "[selow dulu, tarik napas]\\n\\nshare your best moment today â€” besar/kecil gapapa.\\n\\n> you did enough, fr."
            "[halo tim, finish strong bareng]\\n\\nclose one tab, jot one note for tomorrow, log off with peace.\\n\\n> youâ€™re allowed to slow down."
            "[golden hour check]\\n\\nif mager, at least tidy desk 2 menit â€” tiny reset, big vibe.\\n\\n> tomorrow you will thank you."
          )
          footers=("reflect, then reset" "gratitude > grind" "light close, easy start" "sunset on, stress off")

          idx=$((RANDOM % ${#titles[@]}))
          export TITLE="${titles[$idx]}" DESC="${descs[$idx]}" FOOT="${footers[$idx]}" COLOR=16744448 TS

          # Simplified JSON generation without heredoc
          python3 -c '
import json, os
payload = {
    "embeds": [{
        "title": os.environ["TITLE"],
        "description": os.environ["DESC"],
        "color": int(os.environ["COLOR"]),
        "thumbnail": {"url": "https://cdn.discordapp.com/emojis/692428734822645770.gif"},
        "footer": {"text": os.environ["FOOT"], "icon_url": "https://cdn.discordapp.com/emojis/692428869338931240.png"},
        "timestamp": os.environ["TS"]
    }]
}
with open("payload.json", "w") as f:
    json.dump(payload, f)
'
          curl -sS -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" -H "content-type: application/json" --data @payload.json

      - name: send night greeting (rotating)
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.greeting_type == 'night' || github.event.schedule == '0 15 * * 1-5' }}
        run: |
          set -euo pipefail
          TS="$(date -u +%Y-%m-%dT%H:%M:%S.000Z)"

          titles=("ðŸŒ™ night wind down" "ðŸŒ™ good night, gng" "ðŸŒ™ lights low, hearts full" "ðŸŒ™ bedtime ping")
          descs=(
            "[malam semua â€” good job today]\\n\\nmute 2 notifs paling berisik, breathe 4-4-4, tulis satu hal yang bikin kamu senyum.\\n\\n> rest is part of the plan, gn."
            "[yaa, waktunya cooldown]\\n\\nunplug a bit â€” lamp dim, mind calm. besok gas lagi, no rush no drama.\\n\\n> sleep easy, gng."
            "[thank you for today]\\n\\ndrop one tiny win di chat, lalu tutup layar. sisanya besok â€” no cap.\\n\\n> good night, fam."
            "[last call before gn]\\n\\nwash face, water sip, airplane mode â€” then off.\\n\\n> recharge mode: on."
          )
          footers=("recharge mode: on" "sleep easy, wake ready" "see u tomorrow" "dream well, ship well")

          idx=$((RANDOM % ${#titles[@]}))
          export TITLE="${titles[$idx]}" DESC="${descs[$idx]}" FOOT="${footers[$idx]}" COLOR=8947848 TS

          # Simplified JSON generation without heredoc
          python3 -c '
import json, os
payload = {
    "embeds": [{
        "title": os.environ["TITLE"],
        "description": os.environ["DESC"],
        "color": int(os.environ["COLOR"]),
        "thumbnail": {"url": "https://cdn.discordapp.com/emojis/692428734822645770.gif"},
        "footer": {"text": os.environ["FOOT"], "icon_url": "https://cdn.discordapp.com/emojis/692428869338931240.png"},
        "timestamp": os.environ["TS"]
    }]
}
with open("payload.json", "w") as f:
    json.dump(payload, f)
'
          curl -sS -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" -H "content-type: application/json" --data @payload.json
