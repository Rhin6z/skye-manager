name: daily discord greeting

on:
  schedule:
    # 07:00 WIB (00:00 UTC) - weekdays
    - cron: '0 0 * * 1-5'
    # 12:00 WIB (05:00 UTC)
    - cron: '0 5 * * 1-5'
    # 17:00 WIB (10:00 UTC)
    - cron: '0 10 * * 1-5'
    # 22:00 WIB (15:00 UTC)
    - cron: '0 15 * * 1-5'

  workflow_dispatch:
    inputs:
      greeting_type:
        description: 'select greeting type'
        required: true
        default: 'morning'
        type: choice
        options:
          - morning
          - afternoon
          - evening
          - night

jobs:
  send-greeting:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: Check webhook URL
        run: |
          if [ -z "${{ secrets.DISCORD_WEBHOOK_URL }}" ]; then
            echo "ERROR: DISCORD_WEBHOOK_URL secret is not set"
            exit 1
          fi

      - name: send morning greeting (rotating)
        if: (github.event_name == 'workflow_dispatch' && github.event.inputs.greeting_type == 'morning') || github.event.schedule == '0 0 * * 1-5'
        run: |
          set -e
          
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%S.000Z)
          
          # Use arrays with proper bash syntax
          declare -a TITLES=(
            "ğŸŒ„ pagi woy, bangun dulu lahâ€”jangan jadi beban kasur ğŸ˜´"
            "ğŸŒ… gas tipis, gausa ngegasâ€”pelan tapi jalan, anjayy"
            "ğŸ£ morning squad, kopi dulu baru bacot produktif â˜•"
            "ğŸŒ… push rank kehidupan dikit-dikit yaa, santai tapi nyicil âœ¨"
            "â˜€ï¸ rejeki ayam aja pagi, masa lu kalah sama ayam ğŸ“"
            "ğŸŒ selamat pagi, fokus ke 1 hal aja duluâ€”sisanya belakangan"
          )

          declare -a DESCS=(
            "yo morning fam! new day new grind, no capâ€”jangan afk mulu anying. bangun siang mah auto low rank fr ğŸ˜\\n> by server dev - <@399393175904714752>"
            "rise up squad! fresh start, keep it steadyâ€”gerak dikit aja udah win. jangan jadi pajangan lobby, kocak ğŸ˜‚\\n> by server dev - <@399393175904714752>"
            "gm legends! touch grass or touch goalsâ€”pilih satu dulu. pelanÂ² tapi konsisten, jangan banyak alasan anjir.\\n> by server dev - <@399393175904714752>"
            "top of the morning, brodie! small dubs matterâ€”minum air, tarik napas, abis itu gas tipis. jangan typo hidup lu sendiri lah ğŸ˜´\\n> by server dev - <@399393175904714752>"
            "good morning gang! lowkey today feels winnableâ€”asal lu bukan npc parkir di base, cuk. kopi dulu terus jalan.\\n> by server dev - <@399393175904714752>"
            "mornin' squad! no snooze, just movesâ€”bikin progress 1% juga udah mantap. jangan drama dulu, save buat nanti ğŸ¤\\n> by server dev - <@399393175904714752>"
          )

          declare -a FOOTERS=(
            "gas pelan tapi tahan lama"
            "semangat tipis-tipis"
            "santuy tapi kelar"
            "ggwp pagi"
            "the show keeps going"
            "gak tamat gak asik"
          )

          # Generate random index
          INDEX=$((RANDOM % 6))
          
          # Create JSON with proper escaping
          cat > payload.json << 'EOF'
          {
            "embeds": [{
              "title": "TITLE_PLACEHOLDER",
              "description": "DESC_PLACEHOLDER",
              "color": 16766720,
              "thumbnail": {
                "url": "https://cdn.discordapp.com/attachments/1365248252009644053/1407333123791786077/logo_anim.gif"
              },
              "footer": {
                "text": "FOOTER_PLACEHOLDER",
                "icon_url": "https://files.catbox.moe/npfh4e.jpg"
              },
              "timestamp": "TIMESTAMP_PLACEHOLDER"
            }]
          }
          EOF

          # Replace placeholders with proper escaping
          sed -i "s|TITLE_PLACEHOLDER|${TITLES[$INDEX]}|g" payload.json
          sed -i "s|DESC_PLACEHOLDER|${DESCS[$INDEX]}|g" payload.json
          sed -i "s|FOOTER_PLACEHOLDER|${FOOTERS[$INDEX]}|g" payload.json
          sed -i "s|TIMESTAMP_PLACEHOLDER|${TIMESTAMP}|g" payload.json

          # Debug output
          echo "Sending morning greeting (index: $INDEX)"
          echo "Payload preview:"
          head -10 payload.json

          # Send with retry logic
          for i in {1..3}; do
            if curl -f -sS -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
                   -H "Content-Type: application/json" \
                   -H "User-Agent: GitHub-Actions-Bot/1.0" \
                   --data @payload.json \
                   --connect-timeout 10 \
                   --max-time 30; then
              echo "Message sent successfully on attempt $i"
              break
            else
              echo "Attempt $i failed, retrying in 5 seconds..."
              sleep 5
            fi
          done

      - name: send afternoon greeting (rotating)
        if: (github.event_name == 'workflow_dispatch' && github.event.inputs.greeting_type == 'afternoon') || github.event.schedule == '0 5 * * 1-5'
        run: |
          set -e
          
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%S.000Z)
          
          declare -a TITLES=(
            "ğŸŒ siangÂ² gini, nap duluâ€”reset otak bentaran"
            "ğŸ” lunch dulu ga sih? perut ga bisa diajak nego"
            "ğŸ® break tipis, biar ga kebakar kaya cpu fan 100%"
            "âœ¨ tengah hari check: masih waras? hydrate dulu"
            "ğŸ˜ santai, lu bukan robotâ€”ga usah sok 24/7 on"
            "ğŸ’¡ ide liar biasanya muncul abis makanâ€”gas"
          )

          declare -a DESCS=(
            "what's good squad? half the day cooked, lowkey saatnya refill energy. makan siang itu buff, bukan side quest anying ğŸ”\\n> by server dev - <@399393175904714752>"
            "yo fam! pace yourself, no burnoutâ€”isi perut dulu biar aim ga ngaco. jangan jadi singa di chat, koala di real life ğŸ˜´\\n> by server dev - <@399393175904714752>"
            "good afternoon gamers! hydrate or diedrateâ€”minum dulu terus nap dikit, baru lanjut war. drama nanti aja kocak.\\n> by server dev - <@399393175904714752>"
            "sup team! mid-day vibe checkâ€”kalau kepala panas, cooldown 10 menit. baliknya jangan salty, malu dong anjir ğŸ˜Œ\\n> by server dev - <@399393175904714752>"
            "hey brodie! snack, stretch, scroll dikitâ€”yang penting baliknya fresh. jangan overcommit, nanti overtilt.\\n> by server dev - <@399393175904714752>"
            "afternoon gang! \"makan, jangan makan temen.\" (Windut) â€” tapi kalo makan bareng sih hayuk ğŸ”¥\\n> by server dev - <@399393175904714752>"
          )

          declare -a FOOTERS=(
            "santai sejenak"
            "recharge dulu"
            "makan dulu, boss!"
            "stay chill"
            "stay hydrated"
            "weekend vibes"
          )

          INDEX=$((RANDOM % 6))
          
          cat > payload.json << 'EOF'
          {
            "embeds": [{
              "title": "TITLE_PLACEHOLDER",
              "description": "DESC_PLACEHOLDER",
              "color": 16763904,
              "thumbnail": {
                "url": "https://cdn.discordapp.com/attachments/1365248252009644053/1407333123791786077/logo_anim.gif"
              },
              "footer": {
                "text": "FOOTER_PLACEHOLDER",
                "icon_url": "https://files.catbox.moe/npfh4e.jpg"
              },
              "timestamp": "TIMESTAMP_PLACEHOLDER"
            }]
          }
          EOF

          sed -i "s|TITLE_PLACEHOLDER|${TITLES[$INDEX]}|g" payload.json
          sed -i "s|DESC_PLACEHOLDER|${DESCS[$INDEX]}|g" payload.json
          sed -i "s|FOOTER_PLACEHOLDER|${FOOTERS[$INDEX]}|g" payload.json
          sed -i "s|TIMESTAMP_PLACEHOLDER|${TIMESTAMP}|g" payload.json

          echo "Sending afternoon greeting (index: $INDEX)"
          
          for i in {1..3}; do
            if curl -f -sS -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
                   -H "Content-Type: application/json" \
                   -H "User-Agent: GitHub-Actions-Bot/1.0" \
                   --data @payload.json \
                   --connect-timeout 10 \
                   --max-time 30; then
              echo "Message sent successfully on attempt $i"
              break
            else
              echo "Attempt $i failed, retrying in 5 seconds..."
              sleep 5
            fi
          done

      - name: send evening greeting (rotating)
        if: (github.event_name == 'workflow_dispatch' && github.event.inputs.greeting_type == 'evening') || github.event.schedule == '0 10 * * 1-5'
        run: |
          set -e
          
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%S.000Z)
          
          declare -a TITLES=(
            "ğŸŒ† soreÂ², turunin rpmâ€”cooldown dulu lah"
            "ğŸŒ… golden hour = izin buat log off pelanÂ²"
            "â˜• ngopi senja? boleh. overthink? ntar aja"
            "ğŸŒƒ jangan sok produktif 24/7, chill dulu kek"
            "âœ¨ bosen? ganti suasana 15 menit, balik war lagi"
            "ğŸŒ  cukupin buat hari ini, sisanya besok aja"
          )

          declare -a DESCS=(
            "good evening gamers! vibe check dulu, sunset hits differentâ€”santai bentar biar ga tilt, feeding itu dosa sosial anjir ğŸ˜‚\\n> by server dev - <@399393175904714752>"
            "yo evening fam! log off pelanÂ², nyalain musik, mute drama. besok masih panjang, sekarang santai aja dulu anying.\\n> by server dev - <@399393175904714752>"
            "evening squad! cooldown duluâ€”ganti playlist, cemil dikit, terus balik war. lose streak jangan sampe bikin uninstall kocak ğŸ¤¡\\n> by server dev - <@399393175904714752>"
            "what's poppin brodie! golden hour momentâ€”ketawain aja dikit, mmr turun ga sekejam kata netizen kok fr ğŸ˜Œ\\n> by server dev - <@399393175904714752>"
            "good evening team! ganti map: dari kerja ke santai. snack dikit, chat dikit, hidup aman. slow is a strat fr.\\n> by server dev - <@399393175904714752>"
            "good evening gang! \"jangan panik, ini cuma game.\" (Windut) tapi kalo lose streak, off mic bentar gapapa ğŸ˜®â€ğŸ’¨\\n> by server dev - <@399393175904714752>"
          )

          declare -a FOOTERS=(
            "chill vibes only"
            "rest & recharge"
            "malam ini milik kita"
            "santai sejenak"
            "waktunya nge-game"
            "ggwp"
          )

          INDEX=$((RANDOM % 6))
          
          cat > payload.json << 'EOF'
          {
            "embeds": [{
              "title": "TITLE_PLACEHOLDER",
              "description": "DESC_PLACEHOLDER",
              "color": 16744448,
              "thumbnail": {
                "url": "https://cdn.discordapp.com/attachments/1365248252009644053/1407333123791786077/logo_anim.gif"
              },
              "footer": {
                "text": "FOOTER_PLACEHOLDER",
                "icon_url": "https://files.catbox.moe/npfh4e.jpg"
              },
              "timestamp": "TIMESTAMP_PLACEHOLDER"
            }]
          }
          EOF

          sed -i "s|TITLE_PLACEHOLDER|${TITLES[$INDEX]}|g" payload.json
          sed -i "s|DESC_PLACEHOLDER|${DESCS[$INDEX]}|g" payload.json
          sed -i "s|FOOTER_PLACEHOLDER|${FOOTERS[$INDEX]}|g" payload.json
          sed -i "s|TIMESTAMP_PLACEHOLDER|${TIMESTAMP}|g" payload.json

          echo "Sending evening greeting (index: $INDEX)"
          
          for i in {1..3}; do
            if curl -f -sS -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
                   -H "Content-Type: application/json" \
                   -H "User-Agent: GitHub-Actions-Bot/1.0" \
                   --data @payload.json \
                   --connect-timeout 10 \
                   --max-time 30; then
              echo "Message sent successfully on attempt $i"
              break
            else
              echo "Attempt $i failed, retrying in 5 seconds..."
              sleep 5
            fi
          done

      - name: send night greeting (rotating)
        if: (github.event_name == 'workflow_dispatch' && github.event.inputs.greeting_type == 'night') || github.event.schedule == '0 15 * * 1-5'
        run: |
          set -e
          
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%S.000Z)
          
          declare -a TITLES=(
            "ğŸŒ™ time to power downâ€”good night"
            "ğŸ’¤ tidur dulu, biar besok ga error 500"
            "âœ¨ bobo cantik, mimpi yang manis"
            "ğŸš€ hari ini tamat. besok season baru"
            "ğŸ˜´ rest mode: ON. notif: OFF"
            "ğŸŒ™ malem ini buat recharge, bukan overthink"
          )

          declare -a DESCS=(
            "night night squad! log off, rechargeâ€”no heroics tonight. hp aja ada low battery warning anying âš¡ lu juga perlu tidur.\\n> by server dev - <@399393175904714752>"
            "good night fam! save progress, close appâ€”bukan close friend. besok lanjut war dengan energi full, fr.\\n> by server dev - <@399393175904714752>"
            "sleep tight gamers! jangan bawa rank ke mimpiâ€”biar hati ga kebakaran. bobo bentar aja udah beda, kocak.\\n> by server dev - <@399393175904714752>"
            "gn team! \"tidur itu penting, gengs.\" (Windut) tahan dikit lawan fyp, tutup hp, tutup mata.\\n> by server dev - <@399393175904714752>"
            "rest well brodie! yang belum kelar, besok hajar. sekarang waktunya jadi guling enjoyer, no cap.\\n> by server dev - <@399393175904714752>"
            "good night gang! jangan flex begadangâ€”besok pagi malah jadi npc ngantuk, anjir ğŸ˜´\\n> by server dev - <@399393175904714752>"
          )

          declare -a FOOTERS=(
            "tidur, cuy"
            "recharge like a legend"
            "mimpi indah"
            "rest well"
            "see u tomorrow"
            "digital detox"
          )

          INDEX=$((RANDOM % 6))
          
          cat > payload.json << 'EOF'
          {
            "embeds": [{
              "title": "TITLE_PLACEHOLDER",
              "description": "DESC_PLACEHOLDER",
              "color": 8947848,
              "thumbnail": {
                "url": "https://cdn.discordapp.com/attachments/1365248252009644053/1407333123791786077/logo_anim.gif"
              },
              "footer": {
                "text": "FOOTER_PLACEHOLDER",
                "icon_url": "https://files.catbox.moe/npfh4e.jpg"
              },
              "timestamp": "TIMESTAMP_PLACEHOLDER"
            }]
          }
          EOF

          sed -i "s|TITLE_PLACEHOLDER|${TITLES[$INDEX]}|g" payload.json
          sed -i "s|DESC_PLACEHOLDER|${DESCS[$INDEX]}|g" payload.json
          sed -i "s|FOOTER_PLACEHOLDER|${FOOTERS[$INDEX]}|g" payload.json
          sed -i "s|TIMESTAMP_PLACEHOLDER|${TIMESTAMP}|g" payload.json

          echo "Sending night greeting (index: $INDEX)"
          
          for i in {1..3}; do
            if curl -f -sS -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
                   -H "Content-Type: application/json" \
                   -H "User-Agent: GitHub-Actions-Bot/1.0" \
                   --data @payload.json \
                   --connect-timeout 10 \
                   --max-time 30; then
              echo "Message sent successfully on attempt $i"
              break
            else
              echo "Attempt $i failed, retrying in 5 seconds..."
              sleep 5
            fi
          done