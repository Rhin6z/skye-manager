name: weekend discord greeting

on:
  schedule:
    - cron: '0 0 * * 6,0'
    - cron: '0 5 * * 6,0'
    - cron: '0 10 * * 6,0'
    - cron: '0 15 * * 6,0'
  workflow_dispatch:
    inputs:
      greeting_type:
        description: 'select greeting type (weekend)'
        required: true
        default: 'morning'
        type: choice
        options:
          - morning
          - afternoon
          - evening
          - night

jobs:
  send-greeting:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: Check webhook URL
        run: |
          if [ -z "${{ secrets.DISCORD_WEBHOOK_URL }}" ]; then
            echo "ERROR: DISCORD_WEBHOOK_URL secret is not set"
            exit 1
          fi

      - name: send morning greeting (weekend, rotating)
        if: (github.event_name == 'workflow_dispatch' && github.event.inputs.greeting_type == 'morning') || github.event.schedule == '0 0 * * 6,0'
        run: |
          set -euo pipefail
          
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%S.000Z)
          INDEX=$((RANDOM % 6))
          
          case $INDEX in
            0)
              TITLE="ğŸŒ… weekend mode on â€” jangan buru-buru, rileks dulu"
              DESC="yo weekend warriors! no alarms, no stress â€” rebahan is the endgame today. bangun siang? gapapa bro, asal jangan skip makan, anying ğŸ˜´\\n> by server dev - <@399393175904714752>"
              FOOTER="weekend mode: ON"
              ;;
            1)
              TITLE="ğŸ›Œ alarm off, hidup on â€” santai woy"
              DESC="good morning fam! lowkey today is for soft launch only â€” jalanin pelan, jangan jadi npc ngantuk doang kocak â˜•\\n> by server dev - <@399393175904714752>"
              FOOTER="santuy, boss!"
              ;;
            2)
              TITLE="â˜€ï¸ pagi santuy, kopi santuy, vibe santuy"
              DESC="gm squad! new day same chill â€” mandi opsional, sarapan wajib. jangan sok produktif, nanti kena karma monday fr ğŸ˜‚\\n> by server dev - <@399393175904714752>"
              FOOTER="rebahan authorized"
              ;;
            3)
              TITLE="ğŸ® pagi weekend: login yang penting, bukan logika"
              DESC="morning gang! touch grass or touch rank, pilih satu dulu. yang penting happy, bukan heboh, anjir ğŸŒ¿\\n> by server dev - <@399393175904714752>"
              FOOTER="slow but happy"
              ;;
            4)
              TITLE="ğŸ˜´ rebahan is content â€” approved"
              DESC="top of the morning brodie! weekend tuh patch khusus: buff ketawa, nerf drama. nikmatin aja dulu lah ğŸ˜Œ\\n> by server dev - <@399393175904714752>"
              FOOTER="GG ez weekend"
              ;;
            5)
              TITLE="ğŸŒ„ slow morning, big vibe"
              DESC="good morning legends! \"gak tamat gak asik!\" (Windut) â€” tapi tamatnya boleh tamat tidur siang juga sih ğŸ˜´\\n> by server dev - <@399393175904714752>"
              FOOTER="no rush, just vibes"
              ;;
          esac

          PAYLOAD=$(cat <<EOF
          {
            "embeds": [{
              "title": "${TITLE}",
              "description": "${DESC}",
              "color": 16766720,
              "thumbnail": {
                "url": "https://cdn.discordapp.com/attachments/1365248252009644053/1407333123791786077/logo_anim.gif"
              },
              "footer": {
                "text": "${FOOTER}",
                "icon_url": "https://files.catbox.moe/npfh4e.jpg"
              },
              "timestamp": "${TIMESTAMP}"
            }]
          }
          EOF
          )

          echo "Sending weekend morning greeting (index: $INDEX)"
          
          for attempt in {1..3}; do
            if echo "$PAYLOAD" | curl -f -sS -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
                   -H "Content-Type: application/json" \
                   -H "User-Agent: GitHub-Actions-Bot/1.0" \
                   --data-binary @- \
                   --connect-timeout 10 \
                   --max-time 30; then
              echo "âœ… Message sent successfully on attempt $attempt"
              exit 0
            else
              echo "âŒ Attempt $attempt failed, retrying in 5 seconds..."
              sleep 5
            fi
          done
          echo "âŒ All attempts failed"
          exit 1

      - name: send afternoon greeting (weekend, rotating)
        if: (github.event_name == 'workflow_dispatch' && github.event.inputs.greeting_type == 'afternoon') || github.event.schedule == '0 5 * * 6,0'
        run: |
          set -euo pipefail
          
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%S.000Z)
          INDEX=$((RANDOM % 6))
          
          case $INDEX in
            0)
              TITLE="ğŸ” siang santai, perut kenyang, hati senang"
              DESC="what's good squad! half the day cooked â€” refill energy dulu. makan siang itu buff utama, bukan side quest, anying ğŸ”\\n> by server dev - <@399393175904714752>"
              FOOTER="santai sejenak"
              ;;
            1)
              TITLE="ğŸŒ weekend lunch buff â€” claim now"
              DESC="yo fam! siang gini enaknya makan trus rebahan 15 menit â€” bukan koma 5 jam ya, kocak ğŸ˜´\\n> by server dev - <@399393175904714752>"
              FOOTER="recharge dulu"
              ;;
            2)
              TITLE="ğŸ˜ half-day done, full-chill ahead"
              DESC="good afternoon gamers! hydrate or diedrate â€” minum dulu, baru lanjut mabar. jangan salty garaÂ² lapar fr ğŸ¥¤\\n> by server dev - <@399393175904714752>"
              FOOTER="makan dulu, boss!"
              ;;
            3)
              TITLE="ğŸ§ siangÂ² enaknya ngemil + nge-meme"
              DESC="sup team! weekend tuh bukan kompetisi produktif â€” enjoy dulu, produktifnya ngelawak aja di vc ğŸ˜‚\\n> by server dev - <@399393175904714752>"
              FOOTER="stay chill"
              ;;
            4)
              TITLE="ğŸ¥¤ hydrate dulu, gosip nanti"
              DESC="hey brodie! kalau perut kosong, aim pasti goyang â€” isi dulu biar malem ga tepar, anjir\\n> by server dev - <@399393175904714752>"
              FOOTER="stay hydrated"
              ;;
            5)
              TITLE="ğŸ›‹ï¸ post-lunch nap is meta"
              DESC="afternoon gang! \"makan, jangan makan temen.\" (Windut) â€” tapi kalo makan bareng sih hayuk ğŸ”¥\\n> by server dev - <@399393175904714752>"
              FOOTER="weekend vibes"
              ;;
          esac

          PAYLOAD=$(cat <<EOF
          {
            "embeds": [{
              "title": "${TITLE}",
              "description": "${DESC}",
              "color": 16763904,
              "thumbnail": {
                "url": "https://cdn.discordapp.com/attachments/1365248252009644053/1407333123791786077/logo_anim.gif"
              },
              "footer": {
                "text": "${FOOTER}",
                "icon_url": "https://files.catbox.moe/npfh4e.jpg"
              },
              "timestamp": "${TIMESTAMP}"
            }]
          }
          EOF
          )

          echo "Sending weekend afternoon greeting (index: $INDEX)"
          
          for attempt in {1..3}; do
            if echo "$PAYLOAD" | curl -f -sS -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
                   -H "Content-Type: application/json" \
                   -H "User-Agent: GitHub-Actions-Bot/1.0" \
                   --data-binary @- \
                   --connect-timeout 10 \
                   --max-time 30; then
              echo "âœ… Message sent successfully on attempt $attempt"
              exit 0
            else
              echo "âŒ Attempt $attempt failed, retrying in 5 seconds..."
              sleep 5
            fi
          done
          echo "âŒ All attempts failed"
          exit 1

      - name: send evening greeting (weekend, rotating)
        if: (github.event_name == 'workflow_dispatch' && github.event.inputs.greeting_type == 'evening') || github.event.schedule == '0 10 * * 6,0'
        run: |
          set -euo pipefail
          
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%S.000Z)
          INDEX=$((RANDOM % 6))
          
          case $INDEX in
            0)
              TITLE="ğŸŒ† golden hour + good company = w"
              DESC="good evening gamers! vibe check dulu â€” sunset hits different brodie. santai bentar biar ga tilt, feeding itu dosa sosial anjir ğŸ˜‚\\n> by server dev - <@399393175904714752>"
              FOOTER="chill vibes only"
              ;;
            1)
              TITLE="ğŸŒ… sore santai, drama off"
              DESC="yo evening fam! log off pelanÂ², nyalain musik, mute drama. weekend tuh untuk war yang fun, bukan debat kusir anying ğŸ§\\n> by server dev - <@399393175904714752>"
              FOOTER="rest & recharge"
              ;;
            2)
              TITLE="ğŸ® evening queue: chill first, rank later"
              DESC="evening squad! ganti playlist, cemil dikit, lanjut mabar. lose streak? break dulu 10 menit, jangan nekat uninstall kocak ğŸ¤¡\\n> by server dev - <@399393175904714752>"
              FOOTER="malam ini milik kita"
              ;;
            3)
              TITLE="ğŸ¿ camilan siap, ketawa siap"
              DESC="what's poppin gang! ketawa tipis, ngobrol receh â€” mmr turun ga sekejam komentar netizen kok fr ğŸ˜Œ\\n> by server dev - <@399393175904714752>"
              FOOTER="santai sejenak"
              ;;
            4)
              TITLE="ğŸµ lagu enak, obrolan receh"
              DESC="good evening team! \"jangan panik, ini cuma game.\" (Windut) â€” kalo lagi apes, jadi penonton lucu aja dulu ğŸ˜®â€ğŸ’¨\\n> by server dev - <@399393175904714752>"
              FOOTER="waktunya nge-game"